import{Button,LoadingCover}from"./components/_components.min.js";import{request}from"./libs/utils.min.js";import Cookies from"./libs/js-cookie.min.js";function loginScreen(){let o={loading:!1,username:"",password:"",error:""};return{view:function(){let e=[];""!==o.error&&e.push(m("p.login__error",o.error));let n=[];return o.loading&&n.push(m(LoadingCover)),m(".login",...e,m(".login__form",m("img.login__logo",{src:"/res/logo.svg"}),m("input[type=text].login__input",{value:o.username,placeholder:"Username",oninput(e){o.username=e.target.value}}),m("input[type=password].login__input",{value:o.password,placeholder:"Password",oninput(e){o.password=e.target.value}}),m(Button,{class:"login__button",caption:"Login",loading:o.loading,onclick(){!function(){o.loading=!0,o.error="",m.redraw();let e={method:"POST",body:JSON.stringify({username:o.username,password:o.password})};request("/api/login","5s",e).then(o=>{let e=o.session,n=o.user||null;Cookies.set("session-server",e),localStorage.setItem("user",JSON.stringify(n)),window.location.href="/"}).catch(e=>{o.error=e.message}).finally(()=>{o.loading=!1,m.redraw()})}()}})),...n)},oncreate:function(o){o.dom.querySelector(".login__input").focus()}}}export function startApp(){m.mount(document.body,loginScreen)}