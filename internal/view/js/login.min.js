import{Button,LoadingCover}from"./components/_components.min.js";import{request}from"./libs/utils.min.js";import{i18n}from"./i18n/i18n.min.js";import Cookies from"./libs/js-cookie.min.js";function loginScreen(){let o={loading:!1,username:"",password:"",error:""};return{view:function(){let n=[];""!==o.error&&n.push(m("p.login__error",o.error));let e=[];return o.loading&&e.push(m(LoadingCover)),m(".login",...n,m(".login__form",m("img.login__logo",{src:"/res/logo.svg"}),m("input[type=text].login__input",{value:o.username,placeholder:i18n("Username"),oninput(n){o.username=n.target.value}}),m("input[type=password].login__input",{value:o.password,placeholder:i18n("Password"),oninput(n){o.password=n.target.value}}),m(Button,{class:"login__button",caption:i18n("Login"),loading:o.loading,onclick(){!function(){o.loading=!0,o.error="",m.redraw();let n={method:"POST",body:JSON.stringify({username:o.username,password:o.password})};request("/api/login","5s",n).then(o=>{let n=o.session,e=o.user||null;Cookies.set("session-duit",n,{expires:365}),localStorage.setItem("duit-user",JSON.stringify(e)),window.location.href="/"}).catch(n=>{o.error=n.message}).finally(()=>{o.loading=!1,m.redraw()})}()}})),...e)},oncreate:function(o){o.dom.querySelector(".login__input").focus()}}}export function startApp(){m.mount(document.body,loginScreen)}