import{Button,LoadingCover}from"./components/_components.min.js";import{request}from"./libs/utils.min.js";import{i18n}from"./i18n/i18n.min.js";import Cookies from"./libs/js-cookie.min.js";function loginScreen(){let o={loading:!1,username:"",password:"",error:""};return{view:function(){let e=[];""!==o.error&&e.push(m("p.login__error",o.error));let n=[];o.loading&&n.push(m(LoadingCover));let r=i18n("Original logo by $author from $website").split(" ").map(o=>"$author"===o?m("a.attribution__link",{target:"_blank",rel:"noopener",href:"https://www.flaticon.com/authors/freepik"},"Freepik "):"$website"===o?m("a.attribution__link",{target:"_blank",rel:"noopener",href:"https://www.flaticon.com"},"www.flaticon.com "):o+" ");return m(".login",m(".login__body",...e,m(".login__form",m("img.login__logo",{src:"/res/logo.svg"}),m("input[type=text].login__input",{value:o.username,placeholder:i18n("Username"),oninput(e){o.username=e.target.value}}),m("input[type=password].login__input",{value:o.password,placeholder:i18n("Password"),oninput(e){o.password=e.target.value}}),m(Button,{class:"login__button",caption:i18n("Login"),loading:o.loading,onclick(){!function(){o.loading=!0,o.error="",m.redraw();let e={method:"POST",body:JSON.stringify({username:o.username,password:o.password})};request("/api/login","5s",e).then(o=>{let e=o.session,n=o.user||null;Cookies.set("session-duit",e,{expires:365}),localStorage.setItem("duit-user",JSON.stringify(n)),window.location.href="/"}).catch(e=>{o.error=e.message}).finally(()=>{o.loading=!1,m.redraw()})}()}}))),m("p.attribution",r),...n)},oncreate:function(o){o.dom.querySelector(".login__input").focus()}}}export function startApp(){m.mount(document.body,loginScreen)}