import{Button,Dialog}from"../components/_components.min.js";import{cloneObject}from"../libs/utils.min.js";export function DialogForm(){let e={};return{view:function(t){let o=t.attrs.title,a=t.attrs.loading,l=t.attrs.message,n=t.attrs.fields,i=t.attrs.onRejected,r=t.attrs.onAccepted;"string"!=typeof o&&(o=""),"string"!=typeof l&&(l=""),"boolean"!=typeof a&&(a=!1),Array.isArray(n)||(n=[]),"function"!=typeof i&&(i=()=>{}),"function"!=typeof r&&(r=()=>{});let s=[],c=[];""!==l&&c.push(m("p.dialog__form__message",l)),n.forEach(t=>{let o,a,l=t.name,n=t.label,i=t.placeholder,r=t.required,p=t.type,d=t.min,_=t.max,u=t.choices,f=t.minlength,g=t.maxlength,b=t.mindate,y=t.maxdate,h=t.disabled;switch("string"!=typeof l&&(l=""),"string"!=typeof n&&(n=""),"string"!=typeof i&&(i=n),"boolean"!=typeof r&&(r=!1),"string"!=typeof p&&(p="text"),"number"!=typeof d&&(d=void 0),"number"!=typeof _&&(_=void 0),Array.isArray(u)||(u=[]),"number"!=typeof f&&(f=void 0),"number"!=typeof g&&(g=void 0),"string"!=typeof b&&(b=void 0),"string"!=typeof y&&(y=void 0),"boolean"!=typeof h&&(h=!1),p){case"text":case"password":case"int":case"float":case"date":case"boolean":case"select":case"textarea":break;default:return}if(""!==l){switch(r&&!h&&s.push(l),""===n||"boolean"===p?a="dialog__form__field--nolabel":c.push(m("p.dialog__form__label",n)),p){case"text":case"password":o=m("input.dialog__form__input",{type:p,class:a,value:e[l],placeholder:i,disabled:h,oninput(t){e[l]=t.target.value}});break;case"int":case"float":o=m("input.dialog__form__input",{type:"number",class:a,value:e[l],placeholder:i,disabled:h,min:d,max:_,oninput(t){e[l]=t.target.value}});break;case"date":o=m("input.dialog__form__input",{type:"date",class:a,value:e[l],placeholder:i,disabled:h,min:b,max:y,oninput(t){e[l]=t.target.value}});break;case"select":let t=u.map(t=>{let o="",a="";return"string"==typeof t?(o=t,a=t):"object"==typeof t&&(o=t.value||"",a=t.caption||""),m("option.dialog__form__select__option",{value:o,selected:o===e[l]},a)});o=m("select.dialog__form__select",{class:a,size:Math.min(t.length,4),oninput(t){e[l]=t.target.value}},t);break;case"textarea":o=m("textarea.dialog__form__textarea",{class:a,value:e[l],placeholder:i,disabled:h,minlength:f,maxlength:g,oninput(t){e[l]=t.target.value}});break;case"boolean":let r={class:a},s={checked:e[l],onkeydown(t){"Enter"!==t.code&&"NumpadEnter"!==t.code||(e[l]=!t.target.checked)},onclick(t){e[l]=t.target.checked}};o=m("label.dialog__form__check",r,m("input[type=checkbox].dialog__form__check__input",s),m("span.dialog__form__check__caption",n))}c.push(o)}});let p=[m(Button,{class:"dialog__button",caption:"OK",loading:a,onclick(){let t=!1,o=cloneObject(e);for(const e in o){let a=-1!==s.indexOf(e),l=n.find(t=>t.name===e),i=o[e],r=l.type;if(void 0!==l){if(a&&""===i){t=!0;break}"int"!==r?"float"!==r?"boolean"===r&&(o[e]=Boolean(i)):o[e]=parseFloat(i)||0:o[e]=parseInt(i,10)||0}else delete o[e]}t||r(o)}})];return a||p.push(m(Button,{class:"dialog__button",caption:"Cancel",onclick(){i()}})),m(Dialog,{title:o,contents:m(".dialog__body.dialog__form",c),buttons:p})},oninit:function(t){let o=t.attrs.fields;Array.isArray(o)||(o=[]),o.forEach(t=>{let o=t.name,a=t.type,l=t.value||"";"string"==typeof o&&""!=o&&(e[o]="boolean"===a?Boolean(l):l.toString())})},oncreate:function(e){let t=e.dom.querySelector(".dialog__form>input");null==t&&(t=e.dom.querySelector(".dialog__form>textarea")),t&&t.focus()}}}