import{Button,LoadingSign}from"./_components.min.js";import{Big}from"../libs/big.min.js";import{mergeObject}from"../libs/utils.min.js";import{i18n,formatDate,formatNumber}from"../i18n/i18n.min.js";export function EntryList(){let e=0;function t(t,n){let i=t.indexOf(n);-1!==i?t.splice(i,1):t.push(n),e=n}function n(t,n){let i=e,o=n;i>o&&(i=n,o=e);for(var r=i;r<=o;r++)-1===t.indexOf(r)&&t.push(r);e=n}return{view:function(e){let i=e.attrs.account,o=e.attrs.entries,r=e.attrs.loading,c=e.attrs.class,a=e.attrs.selection,s=e.attrs.currentPage,l=e.attrs.maxPage,p=e.attrs.onItemClicked,f=e.attrs.onNewClicked,u=e.attrs.onEditClicked,y=e.attrs.onDeleteClicked,g=e.attrs.onPageChanged;"object"!=typeof i&&(i={}),Array.isArray(o)||(o=[]),"boolean"!=typeof r&&(r=!1),"string"!=typeof c&&(c=""),Array.isArray(a)||(a=[]),"number"!=typeof s&&(s=1),"number"!=typeof l&&(l=1),"function"!=typeof p&&(p=()=>{}),"function"!=typeof f&&(f=()=>{}),"function"!=typeof u&&(u=()=>{}),"function"!=typeof y&&(y=()=>{}),"function"!=typeof g&&(g=()=>{});let d=i18n("Entry List");if(null!=i){let e=i.name||"",t=i.total||"0";d=`${e} ${formatNumber(t)}`}let h=[m("p.entry-list__header__title",d)],_={iconOnly:!0,class:"entry-list__header__button"};o.length>0&&!r&&h.unshift(m("input[type=checkbox].entry__check",{checked:a.length===o.length,onclick(){!function(e,t){if(e.length===t)e.splice(0,e.length);else for(var n=0;n<t;n++)-1===e.indexOf(n)&&e.push(n)}(a,o.length)}})),1===a.length&&h.push(m(Button,mergeObject(_,{icon:"fa-pen",caption:i18n("Edit entry"),onclick(){u()}}))),a.length>=1&&h.push(m(Button,mergeObject(_,{icon:"fa-trash-alt",caption:i18n("Delete entry"),onclick(){y()}}))),h.push(m(Button,mergeObject(_,{icon:"fa-plus-circle",caption:i18n("New entry"),onclick(){f()}})));let b=m(".entry-list__header",h),k=[];if(r?k.push(m(LoadingSign,{class:"entry-list__loading-sign"})):0===o.length?k.push(m("p.entry-list__empty-message",i18n("No entries registered"))):(o.forEach((e,r)=>{let c=o[r-1];null!=c&&e.date===c.date||k.push(m("p.entry__date",formatDate(e.date)));let s="",l=Big(e.amount),p=e.description||"";switch(e.type){case 1:s="entry--income";break;case 2:s="entry--expense",l=l.times(-1);break;case 3:let t="";(i.id||-1)===e.affectedAccountId?(s="entry--income",t=i18n("Received from $name").replace("$name",e.account)):(s="entry--expense",t=i18n("Transferred to $name").replace("$name",e.account),l=l.times(-1)),p=p||t}let f,u={checked:-1!==a.indexOf(r),onclick(e){e.shiftKey?n(a,r):t(a,r)},onkeydown(e){"Enter"!==e.code&&"NumpadEnter"!==e.code||(e.shiftKey?n(a,r):t(a,r))}};3===e.type&&(f="entry--transfer"),k.push(m(".entry",m("input[type=checkbox].entry__check",u),m("p.entry__description",{class:f},p),m("p.entry__amount",{class:s},formatNumber(l))))}),k.push(m(".entry-list__space"))),l>1){let e={iconOnly:!0,tooltipPosition:"top",class:"entry-list__footer__button"},t={first:!r&&s>2,prev:!r&&s>1,next:!r&&s<l,last:!r&&s<l-1};k.push(m(".entry-list__footer",m(Button,mergeObject(e,{icon:"fa-angle-double-left",caption:i18n("First page"),enabled:t.first,onclick(){g(1)}})),m(Button,mergeObject(e,{icon:"fa-angle-left",caption:i18n("Previous page"),enabled:t.prev,onclick(){g(s-1)}})),m("p.entry-list__footer__page",`${s} / ${l}`),m(Button,mergeObject(e,{icon:"fa-angle-right",caption:i18n("Next page"),enabled:t.next,onclick(){g(s+1)}})),m(Button,mergeObject(e,{icon:"fa-angle-double-right",caption:i18n("Last page"),enabled:t.last,onclick(){g(l)}}))))}return m(".entry-list",{class:c},[b,k])}}}