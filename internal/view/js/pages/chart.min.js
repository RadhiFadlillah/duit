import{LoadingCover,AccountChart}from"../components/_components.min.js";import{DialogError}from"../dialogs/_dialogs.min.js";import{request}from"../libs/utils.min.js";export function ChartPage(){let r={loading:!1,chart:{year:(new Date).getFullYear(),accounts:[],series:[],min:void 0,max:void 0},dlgError:{message:"",visible:!1}};function e(){r.loading=!0,m.redraw();let e=new URL("/api/charts",document.baseURI);e.searchParams.set("year",r.chart.year),request(e.toString(),"5s").then(e=>{r.chart.accounts=e.accounts,r.chart.series=e.series}).catch(e=>{r.dlgError.message=e.message,r.dlgError.visible=!0}).finally(()=>{r.loading=!1,m.redraw()})}return{view:function(a){let t=[];0===t.length&&r.dlgError.visible&&t.push(m(DialogError,{message:r.dlgError.message,onAccepted(){r.dlgError.visible=!1}}));let o=[];r.loading&&o.push(m(LoadingCover));let n=m(AccountChart,{class:"chart-page__main-chart",loading:r.loading,year:r.chart.year,accounts:r.chart.accounts,series:r.chart.series,onYearChanged(a){r.chart.year=a,e()}});return m(".chart-page",n,...t,...o)},oncreate:function(r){e(r.dom)},onupdate:function(e){r.needToRenderChart&&renderChart(e.dom)}}}